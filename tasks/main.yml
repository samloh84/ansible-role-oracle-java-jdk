
- set_fact:
    temp_dir: "/tmp/java/jdk-{{ java_version }}"
    java_home: "{{ prefix }}/{{ urls[java_version].tarball.dir }}"
    jdk_url: "{{ urls[java_version].tarball.url }}"
    jdk_hash: "{{ urls[java_version].tarball.hash }}"
    jce_version: "{{ urls[java_version].tarball.jce }}"
- set_fact:
    jre_home: "{{ java_home }}/jre"
    jdk_file: "{{ temp_dir }}/{{ urls[java_version].tarball.file }}"
    jce_dir: "{{ temp_dir }}/{{ urls[jce_version].dir }}"
    jce_url: "{{ urls[jce_version].url }}"
    jce_hash: "{{ urls[jce_version].hash }}"
    jce_file: "{{ temp_dir }}/{{ urls[jce_version].file }}"

- file:
    path: "{{ temp_dir }}"
    state: directory

- file:
    path: "{{ java_home }}"
    state: directory

- name: Download JDK
  get_url:
    url: "{{ jdk_url }}"
    dest: "{{ jdk_file }}"
    headers: "Cookie: oraclelicense=accept-securebackup-cookie"
    checksum: "sha256:{{ jdk_hash }}"


- name: Extract JDK
  unarchive:
    src: "{{ jdk_file }}"
    dest: "{{ prefix }}"
    remote_src: yes

- name: Download JCE
  get_url:
    url: "{{ jce_url }}"
    dest: "{{ jce_file }}"
    headers: "Cookie: oraclelicense=accept-securebackup-cookie"
    checksum: "sha256:{{ jce_hash }}"

- name: Extract JCE
  unarchive:
    src: "{{ jce_file }}"
    dest: "{{ temp_dir }}"
    remote_src: yes

- copy: 
    src: "{{ jce_dir }}/US_export_policy.jar"
    dest: "{{ jre_home }}/lib/security/US_export_policy.jar"
    remote_src: yes

- copy:
    src: "{{ jce_dir }}/local_policy.jar"
    dest: "{{ jre_home }}/lib/security/local_policy.jar"
    remote_src: yes

- template: 
    src: "templates/java.sh.j2"
    dest: "/etc/profile.d/java.sh"

- name: Clean Temporary files
  file: 
    path: "{{ temp_dir }}"
    state: absent

